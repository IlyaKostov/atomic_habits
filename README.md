### бэкенд-часть SPA веб-приложения
## «Атомные привычки»

---

---

### [Установка](#title1)
### [Логика работы системы](#title2)
### [Валидация и Права доступа](#title3)
### [Запуск](#title4)
### [Запуск через Docker](#title5)

---

---

## <a id="title1">Для корректной работы системы необходимо:</a>

- Склонируйте репозиторий командой "git clone"
- Запустите виртуальное окружение "poetry shell".
- Установите зависимости "poetry install".
- Создайте в корне файл .env и внесите в него все переменные окружения по образцу из файла .env.sample (по умолчанию в
  системе
  используется база данных PostgreSQL)
- Запустите миграции
```shell
python manage.py migrate
```
В качестве брокера используется Redis
- Установите и запустите сервер redis.

<a id="title2">Логика работы системы</a>
---
Проект представляет собой бэкенд-часть SPA веб-приложения по созданию привычек и взаимодействия с Телеграмм
по отправке уведомлений пользователям о выполнении созданных ими привычек. А так же возможность просматривать 
привычки находящиеся в публичном доступе. 

После регистрации пользователя, необходимо авторизоваться в Телеграмм-боте для получения уведомлений!

Необходимо создать бота через BotFather и получить API-токен, который внести в настройки проекта.


<a id="title3">Валидация и Права доступа</a>
---

- Исключен одновременный выбор связанной привычки и указания вознаграждения.
- Время выполнения должно быть не больше 120 секунд.
- В связанные привычки могут попадать только привычки с признаком приятной привычки.
- У приятной привычки не может быть вознаграждения или связанной привычки.
- Нельзя выполнять привычку реже, чем 1 раз в 7 дней.
- Каждый пользователь имеет доступ только к своим привычкам.
- Пользователь может видеть список публичных привычек без возможности их как-то редактировать или удалять.

<a id="title4">Запуск (на Windows)</a>
---

- Для запуска приложения, используйте команду 
```shell
python manage.py runserver
```
- Для запуска обработчика периодических задач, выполните команду
```shell
celery -A atomic_habits worker -l INFO -P eventlet
```
- Для запуска работы планировщика задач, выполните команду
```shell
celery -A atomic_habits beat -l INFO -S django
```
- Для запуска телеграмм-бота, используйте команду
```shell
python manage.py bot
```


<a id="title5">Запуск через Docker</a>
---

Для того чтобы развернуть контейнер с проектом необходимо выполнить команды:
- Для сборки образов
```shell
docker-compose build
```
- Для запуска контейнеров
```shell
docker-compose up
```

Так же для сборки образа и запуска в фоне после успешной сборки можно использовать команду
```shell
docker-compose up -d -build
```